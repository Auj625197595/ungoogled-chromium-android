From: Wengling Chen <feiyu2817@gmail.com>
Date: Sat, 30 May 2020 18:25:38 -0400
Subject: gn fixes for enable_extensions=true

---
 apps/BUILD.gn                                                        |    2 
 build/config/locales.gni                                             |    4 
 chrome/BUILD.gn                                                      |    4 
 chrome/android/BUILD.gn                                              |    1 
 chrome/browser/BUILD.gn                                              |  233 ----------
 chrome/browser/apps/platform_apps/api/music_manager_private/BUILD.gn |    5 
 chrome/browser/devtools/BUILD.gn                                     |   14 
 chrome/browser/extensions/BUILD.gn                                   |   40 -
 chrome/browser/media/router/discovery/BUILD.gn                       |    4 
 chrome/browser/resources/BUILD.gn                                    |    4 
 chrome/browser/ui/BUILD.gn                                           |   87 ---
 chrome/browser/ui/views/BUILD.gn                                     |    2 
 chrome/browser/ui/webui/discards/BUILD.gn                            |    2 
 chrome/browser/web_applications/BUILD.gn                             |    3 
 chrome/browser/web_applications/components/BUILD.gn                  |    7 
 chrome/browser/web_applications/extensions/BUILD.gn                  |    1 
 chrome/chrome_paks.gni                                               |    2 
 chrome/common/BUILD.gn                                               |    2 
 chrome/common/extensions/api/api_sources.gni                         |    2 
 chrome/common/importer/BUILD.gn                                      |    2 
 chrome/renderer/BUILD.gn                                             |    2 
 chrome/test/BUILD.gn                                                 |    1 
 components/autofill/core/browser/BUILD.gn                            |    2 
 components/bookmarks/browser/BUILD.gn                                |    2 
 components/guest_view/browser/BUILD.gn                               |    2 
 components/guest_view/renderer/BUILD.gn                              |    2 
 components/keep_alive_registry/BUILD.gn                              |    2 
 components/performance_manager/BUILD.gn                              |    2 
 components/web_modal/BUILD.gn                                        |    2 
 components/zoom/BUILD.gn                                             |    2 
 content/browser/BUILD.gn                                             |    2 
 content/browser/devtools/BUILD.gn                                    |    2 
 content/public/browser/BUILD.gn                                      |    2 
 extensions/BUILD.gn                                                  |    1 
 extensions/browser/api/system_cpu/BUILD.gn                           |    4 
 extensions/buildflags/buildflags.gni                                 |    2 
 media/mojo/mojom/BUILD.gn                                            |    2 
 services/device/public/cpp/hid/BUILD.gn                              |    1 
 third_party/blink/public/mojom/BUILD.gn                              |    2 
 ui/base/BUILD.gn                                                     |   18 
 ui/gfx/BUILD.gn                                                      |    2 
 ui/gfx/animation/BUILD.gn                                            |    2 
 ui/message_center/BUILD.gn                                           |    4 
 ui/views/BUILD.gn                                                    |   19 
 ui/webui/resources/BUILD.gn                                          |    4 
 45 files changed, 101 insertions(+), 406 deletions(-)

--- a/apps/BUILD.gn
+++ b/apps/BUILD.gn
@@ -6,7 +6,7 @@ import("//build/config/features.gni")
 import("//build/config/ui.gni")
 import("//extensions/buildflags/buildflags.gni")
 
-assert(!is_android && !is_ios)
+# assert(!is_android && !is_ios)
 assert(enable_extensions,
        "Cannot depend on extensions because enable_extensions=false.")
 
--- a/chrome/browser/media/router/discovery/BUILD.gn
+++ b/chrome/browser/media/router/discovery/BUILD.gn
@@ -2,8 +2,6 @@
 # Use of this source code is governed by a BSD-style license that can be
 # found in the LICENSE file.
 
-assert(!is_android)
-
 static_library("discovery") {
   inputs = [ "$root_gen_dir/chrome/grit/generated_resources.h" ]
   deps = [
@@ -75,7 +73,7 @@ static_library("discovery") {
     sources += [ "discovery_network_list_wifi_linux.cc" ]
   }
 
-  if (is_posix) {
+  if (is_posix && !is_android) {
     sources += [ "discovery_network_list_posix.cc" ]
   }
 
--- a/ui/base/BUILD.gn
+++ b/ui/base/BUILD.gn
@@ -454,6 +454,11 @@ jumbo_component("base") {
     deps += [ "//third_party/re2" ]
   }
 
+  sources += [
+    "dragdrop/os_exchange_data_provider_aura.cc",
+    "dragdrop/os_exchange_data_provider_aura.h",
+  ]
+
   if (!is_ios) {
     # iOS does not use Chromium-specific code for event handling.
     public_deps += [
@@ -613,14 +618,6 @@ jumbo_component("base") {
   if (!toolkit_views && !use_aura) {
     sources -= [
       "dragdrop/drag_drop_types.h",
-      "dragdrop/drop_target_event.cc",
-      "dragdrop/drop_target_event.h",
-      "dragdrop/os_exchange_data.cc",
-      "dragdrop/os_exchange_data.h",
-      "dragdrop/os_exchange_data_provider_factory.cc",
-      "dragdrop/os_exchange_data_provider_factory.h",
-      "nine_image_painter_factory.cc",
-      "nine_image_painter_factory.h",
     ]
   }
 
@@ -629,11 +626,6 @@ jumbo_component("base") {
     libs += [ "jnigraphics" ]
 
     sources -= [
-      "l10n/l10n_font_util.cc",
-      "models/button_menu_item_model.cc",
-      "pointer/touch_editing_controller.cc",
-      "theme_provider.cc",
-      "ui_base_types.cc",
     ]
   }
 
--- a/chrome/browser/web_applications/BUILD.gn
+++ b/chrome/browser/web_applications/BUILD.gn
@@ -204,7 +204,6 @@ source_set("web_applications_unit_tests"
     "//chrome/browser",
     "//chrome/browser/web_applications/components",
     "//chrome/common",
-    "//chrome/test:test_support",
     "//content/public/browser",
     "//content/test:test_support",
     "//services/metrics/public/cpp:ukm_builders",
@@ -252,8 +251,6 @@ source_set("web_applications_browser_tes
     "//chrome/app:command_ids",
     "//chrome/browser/web_applications/components",
     "//chrome/services/app_service/public/cpp:app_update",
-    "//chrome/test:test_support",
-    "//chrome/test:test_support_ui",
     "//components/permissions:permissions",
   ]
 
--- a/chrome/browser/web_applications/components/BUILD.gn
+++ b/chrome/browser/web_applications/components/BUILD.gn
@@ -2,6 +2,8 @@
 # Use of this source code is governed by a BSD-style license that can be
 # found in the LICENSE file.
 
+set_sources_assignment_filter([])
+
 source_set("components") {
   sources = [
     "app_icon_manager.h",
@@ -55,6 +57,8 @@ source_set("components") {
     "web_app_provider_base_factory.h",
     "web_app_shortcut.cc",
     "web_app_shortcut.h",
+    "web_app_shortcut_linux.cc",
+    "web_app_shortcut_linux.h",
     "web_app_shortcuts_menu.cc",
     "web_app_shortcuts_menu.h",
     "web_app_tab_helper_base.cc",
@@ -188,7 +192,6 @@ source_set("unit_tests") {
     "//chrome/browser/web_applications:web_applications",
     "//chrome/browser/web_applications:web_applications_test_support",
     "//chrome/browser/web_applications/extensions:extensions",
-    "//chrome/test:test_support",
     "//content/public/browser",
     "//skia",
     "//testing/gmock",
@@ -218,8 +221,6 @@ source_set("browser_tests") {
   deps = [
     ":components",
     "//chrome/browser/web_applications:web_applications_test_support",
-    "//chrome/test:test_support",
-    "//chrome/test:test_support_ui",
     "//net:test_support",
   ]
 }
--- a/chrome/browser/web_applications/extensions/BUILD.gn
+++ b/chrome/browser/web_applications/extensions/BUILD.gn
@@ -67,7 +67,6 @@ source_set("unit_tests") {
     "//chrome/browser/web_applications:web_applications_test_support",
     "//chrome/browser/web_applications/components",
     "//chrome/common",
-    "//chrome/test:test_support",
     "//components/crx_file:crx_file",
     "//content/public/browser",
     "//content/test:test_support",
--- a/chrome/browser/ui/views/BUILD.gn
+++ b/chrome/browser/ui/views/BUILD.gn
@@ -5,8 +5,6 @@
 import("//build/config/ui.gni")
 import("//ui/views/features.gni")
 
-assert(toolkit_views)
-
 component("views") {
   output_name = "browser_ui_views"
   sources = [
--- a/components/guest_view/browser/BUILD.gn
+++ b/components/guest_view/browser/BUILD.gn
@@ -6,7 +6,7 @@
 # assert to prevent the accidental building of GuestViews on mobile
 # platforms. If you're now using GuestViews on mobile, go ahead and
 # remove this assert.
-assert(!is_android && !is_ios)
+# assert(!is_android && !is_ios)
 
 static_library("browser") {
   output_name = "guest_view_browser"
--- a/components/guest_view/renderer/BUILD.gn
+++ b/components/guest_view/renderer/BUILD.gn
@@ -6,7 +6,7 @@
 # assert to prevent the accidental building of GuestViews on mobile
 # platforms. If you're now using GuestViews on mobile, go ahead and
 # remove this assert.
-assert(!is_android && !is_ios)
+# assert(!is_android && !is_ios)
 
 static_library("renderer") {
   sources = [
--- a/components/keep_alive_registry/BUILD.gn
+++ b/components/keep_alive_registry/BUILD.gn
@@ -2,7 +2,7 @@
 # Use of this source code is governed by a BSD-style license that can be
 # found in the LICENSE file.
 
-assert(!is_android)
+# assert(!is_android)
 
 source_set("keep_alive_registry") {
   sources = [
--- a/components/web_modal/BUILD.gn
+++ b/components/web_modal/BUILD.gn
@@ -2,7 +2,7 @@
 # Use of this source code is governed by a BSD-style license that can be
 # found in the LICENSE file.
 
-assert(!is_android && !is_ios)
+# assert(!is_android && !is_ios)
 
 component("web_modal") {
   sources = [
--- a/components/zoom/BUILD.gn
+++ b/components/zoom/BUILD.gn
@@ -2,7 +2,7 @@
 # Use of this source code is governed by a BSD-style license that can be
 # found in the LICENSE file.
 
-assert(!is_android && !is_ios, "Desktop zoom is not used on mobile platforms.")
+# assert(!is_android && !is_ios, "Desktop zoom is not used on mobile platforms.")
 
 static_library("zoom") {
   sources = [
--- a/extensions/buildflags/buildflags.gni
+++ b/extensions/buildflags/buildflags.gni
@@ -5,7 +5,7 @@
 import("//build/config/features.gni")
 
 declare_args() {
-  enable_extensions = !is_android && !is_ios && !is_fuchsia
+  enable_extensions = !is_ios && !is_fuchsia
 
   # Enables Wi-Fi Display functionality
   # WARNING: This enables MPEG Transport Stream (MPEG-TS) encoding!
--- a/services/device/public/cpp/hid/BUILD.gn
+++ b/services/device/public/cpp/hid/BUILD.gn
@@ -7,7 +7,6 @@ import("//build/config/features.gni")
 source_set("hid") {
   # HID is not implemented on Android and we want to be particularly careful
   # about not bloating binary size by accidentially including it.
-  assert(!is_android)
 
   sources = [
     "fake_input_service_linux.cc",
--- a/ui/views/BUILD.gn
+++ b/ui/views/BUILD.gn
@@ -12,7 +12,7 @@ import("//ui/base/ui_features.gni")
 import("//ui/ozone/ozone.gni")
 import("//ui/views/features.gni")
 
-assert(toolkit_views)
+# assert(toolkit_views)
 
 # Reset sources_assignment_filter for the BUILD.gn file to prevent
 # regression during the migration of Chromium away from the feature.
@@ -152,6 +152,7 @@ jumbo_component("views") {
     "controls/menu/menu_types.h",
     "controls/menu/submenu_view.h",
     "controls/message_box_view.h",
+    "controls/native/native_view_host_aura.h",
     "controls/native/native_view_host.h",
     "controls/native/native_view_host_mac.h",
     "controls/native/native_view_host_wrapper.h",
@@ -188,6 +189,7 @@ jumbo_component("views") {
     "debug_utils.h",
     "drag_controller.h",
     "drag_utils.h",
+    "event_monitor_aura.h",
     "event_monitor.h",
     "focus/external_focus_tracker.h",
     "focus/focus_manager.h",
@@ -250,10 +252,12 @@ jumbo_component("views") {
     "widget/any_widget_observer_singleton.h",
     "widget/drop_helper.h",
     "widget/native_widget.h",
+    "widget/native_widget_aura.h",
     "widget/native_widget_delegate.h",
     "widget/native_widget_private.h",
     "widget/root_view.h",
     "widget/root_view_targeter.h",
+    "widget/tooltip_manager_aura.h",
     "widget/tooltip_manager.h",
     "widget/widget.h",
     "widget/widget_delegate.h",
@@ -342,6 +346,7 @@ jumbo_component("views") {
     "controls/label.cc",
     "controls/link.cc",
     "controls/menu/menu_config.cc",
+    "controls/menu/menu_config_linux.cc",
     "controls/menu/menu_controller.cc",
     "controls/menu/menu_delegate.cc",
     "controls/menu/menu_host.cc",
@@ -349,6 +354,8 @@ jumbo_component("views") {
     "controls/menu/menu_image_util.cc",
     "controls/menu/menu_item_view.cc",
     "controls/menu/menu_model_adapter.cc",
+    "controls/menu/menu_pre_target_handler_aura.cc",
+    "controls/menu/menu_pre_target_handler_aura.h",
     "controls/menu/menu_runner.cc",
     "controls/menu/menu_runner_impl.cc",
     "controls/menu/menu_runner_impl_adapter.cc",
@@ -356,6 +363,7 @@ jumbo_component("views") {
     "controls/menu/menu_separator.cc",
     "controls/menu/submenu_view.cc",
     "controls/message_box_view.cc",
+    "controls/native/native_view_host_aura.cc",
     "controls/native/native_view_host.cc",
     "controls/prefix_selector.cc",
     "controls/progress_bar.cc",
@@ -385,6 +393,8 @@ jumbo_component("views") {
     "controls/views_text_services_context_menu_base.h",
     "debug_utils.cc",
     "drag_utils.cc",
+    "drag_utils_aura.cc",
+    "event_monitor_aura.cc",
     "focus/external_focus_tracker.cc",
     "focus/focus_manager.cc",
     "focus/focus_manager_factory.cc",
@@ -407,9 +417,11 @@ jumbo_component("views") {
     "metadata/metadata_cache.cc",
     "metadata/metadata_types.cc",
     "metadata/type_conversion.cc",
+    "metrics_aura.cc",
     "metrics.cc",
     "mouse_watcher.cc",
     "mouse_watcher_view_host.cc",
+    "native_cursor_aura.cc",
     "paint_info.cc",
     "painter.cc",
     "rect_based_targeting_utils.cc",
@@ -419,6 +431,7 @@ jumbo_component("views") {
     "style/platform_style.cc",
     "style/typography.cc",
     "style/typography_provider.cc",
+    "touchui/touch_selection_controller_impl.cc",
     "view.cc",
     "view_class_properties.cc",
     "view_constants.cc",
@@ -430,12 +443,15 @@ jumbo_component("views") {
     "views_delegate.cc",
     "views_features.cc",
     "views_switches.cc",
+    "views_touch_selection_controller_factory_aura.cc",
     "widget/any_widget_observer.cc",
     "widget/any_widget_observer_singleton.cc",
     "widget/drop_helper.cc",
+    "widget/native_widget_aura.cc",
     "widget/native_widget_private.cc",
     "widget/root_view.cc",
     "widget/root_view_targeter.cc",
+    "widget/tooltip_manager_aura.cc",
     "widget/tooltip_manager.cc",
     "widget/widget.cc",
     "widget/widget_aura_utils.cc",
@@ -483,6 +499,7 @@ jumbo_component("views") {
     "//skia",
     "//third_party/icu",
     "//ui/accessibility",
+    "//ui/android",
     "//ui/base/clipboard",
     "//ui/display",
     "//ui/latency",
--- a/chrome/test/BUILD.gn
+++ b/chrome/test/BUILD.gn
@@ -4917,7 +4917,6 @@ test("unit_tests") {
       "//chrome/common/extensions/api",
       "//components/safe_browsing:buildflags",
       "//components/services/unzip:in_process",
-      "//extensions:extensions_resources",
       "//extensions/browser:test_support",
       "//extensions/browser:value_store_test_support",
       "//extensions/common",
--- a/extensions/BUILD.gn
+++ b/extensions/BUILD.gn
@@ -220,7 +220,6 @@ test("extensions_unittests") {
   ]
 
   deps = [
-    ":extensions_resources",
     ":shell_and_test_pak",
     ":test_support",
     "//base/test:test_support",
--- a/chrome/BUILD.gn
+++ b/chrome/BUILD.gn
@@ -1286,7 +1286,7 @@ group("extra_resources") {
     "//components/autofill/core/browser:autofill_address_rewriter_resources",
   ]
 
-  if (!is_android) {
+  if (enable_extensions || !is_android) {
     public_deps += [
       "//chrome/browser/resources:bookmarks_resources",
       "//chrome/browser/resources:component_extension_resources",
@@ -1310,7 +1310,7 @@ group("extra_resources") {
     ]
   }
 
-  if (!is_android && !is_chromeos) {
+  if (is_android && !is_chromeos) {
     public_deps += [
       "//chrome/browser/resources:profile_picker_resources",
       "//chrome/browser/resources:welcome_resources",
--- a/chrome/browser/resources/BUILD.gn
+++ b/chrome/browser/resources/BUILD.gn
@@ -86,7 +86,7 @@ if (closure_compile) {
   }
 }
 
-if (!is_android) {
+if (enable_extensions || !is_android) {
   grit("bookmarks_resources") {
     grit_flags = [
       "-E",
@@ -307,7 +307,7 @@ if (is_chromeos) {
   }
 }
 
-if (!is_android && !is_chromeos) {
+if (is_android && !is_chromeos) {
   grit("welcome_resources") {
     source = "welcome/welcome_resources.grd"
 
--- a/third_party/blink/public/mojom/BUILD.gn
+++ b/third_party/blink/public/mojom/BUILD.gn
@@ -176,7 +176,7 @@ mojom("mojom_platform") {
     "worker/worker_options.mojom",
   ]
 
-  if (!is_android) {
+  if (is_android) {
     sources += [ "serial/serial.mojom" ]
   }
 
--- a/chrome/browser/BUILD.gn
+++ b/chrome/browser/BUILD.gn
@@ -35,6 +35,8 @@ import("//third_party/webrtc/webrtc.gni"
 import("//third_party/widevine/cdm/widevine.gni")
 import("//ui/base/ui_features.gni")
 
+set_sources_assignment_filter([])
+
 # //build/config/android/rules.gni imports //tools/grit/grit_rule.gni, which
 # produces a conflict for the "grit" template so we have to only include one.
 if (is_android) {
@@ -101,8 +103,6 @@ static_library("browser") {
     "accessibility/caption_util.h",
     "after_startup_task_utils.cc",
     "after_startup_task_utils.h",
-    "app_controller_mac.h",
-    "app_controller_mac.mm",
     "app_mode/app_mode_utils.cc",
     "app_mode/app_mode_utils.h",
     "apps/user_type_filter.cc",
@@ -203,12 +203,6 @@ static_library("browser") {
     "browser_process_platform_part_android.h",
     "browser_process_platform_part_base.cc",
     "browser_process_platform_part_base.h",
-    "browser_process_platform_part_chromeos.cc",
-    "browser_process_platform_part_chromeos.h",
-    "browser_process_platform_part_mac.h",
-    "browser_process_platform_part_mac.mm",
-    "browser_process_platform_part_win.cc",
-    "browser_process_platform_part_win.h",
     "browsing_data/browsing_data_file_system_util.cc",
     "browsing_data/browsing_data_file_system_util.h",
     "browsing_data/browsing_data_history_observer_service.cc",
@@ -253,8 +247,6 @@ static_library("browser") {
     "cache_stats_recorder.h",
     "chooser_controller/chooser_controller.cc",
     "chooser_controller/chooser_controller.h",
-    "chrome_browser_application_mac.h",
-    "chrome_browser_application_mac.mm",
     "chrome_browser_field_trials.cc",
     "chrome_browser_field_trials.h",
     "chrome_browser_interface_binders.cc",
@@ -264,12 +256,6 @@ static_library("browser") {
     "chrome_browser_main_android.cc",
     "chrome_browser_main_android.h",
     "chrome_browser_main_extra_parts.h",
-    "chrome_browser_main_linux.cc",
-    "chrome_browser_main_linux.h",
-    "chrome_browser_main_mac.h",
-    "chrome_browser_main_mac.mm",
-    "chrome_browser_main_win.cc",
-    "chrome_browser_main_win.h",
     "chrome_content_browser_client.cc",
     "chrome_content_browser_client.h",
     "chrome_content_browser_client_parts.h",
@@ -328,8 +314,6 @@ static_library("browser") {
     "component_updater/sth_set_component_remover.h",
     "component_updater/subresource_filter_component_installer.cc",
     "component_updater/subresource_filter_component_installer.h",
-    "component_updater/sw_reporter_installer_win.cc",
-    "component_updater/sw_reporter_installer_win.h",
     "component_updater/tls_deprecation_config_component_installer.cc",
     "component_updater/tls_deprecation_config_component_installer.h",
     "component_updater/trust_token_key_commitments_component_installer.cc",
@@ -399,7 +383,6 @@ static_library("browser") {
     "download/download_core_service_factory.h",
     "download/download_core_service_impl.cc",
     "download/download_core_service_impl.h",
-    "download/download_crx_util_android.cc",
     "download/download_file_picker.cc",
     "download/download_file_picker.h",
     "download/download_history.cc",
@@ -430,8 +413,6 @@ static_library("browser") {
     "download/download_stats.h",
     "download/download_status_updater.cc",
     "download/download_status_updater.h",
-    "download/download_status_updater_mac.mm",
-    "download/download_status_updater_win.cc",
     "download/download_target_determiner.cc",
     "download/download_target_determiner.h",
     "download/download_target_determiner_delegate.h",
@@ -443,6 +424,7 @@ static_library("browser") {
     "download/download_ui_controller.h",
     "download/download_ui_model.cc",
     "download/download_ui_model.h",
+    "download/drag_download_item_aura.cc",
     "download/drag_download_item.h",
     "download/mixed_content_download_blocking.cc",
     "download/mixed_content_download_blocking.h",
@@ -461,7 +443,6 @@ static_library("browser") {
     "download/simple_download_manager_coordinator_factory.h",
     "download/trusted_sources_manager.cc",
     "download/trusted_sources_manager.h",
-    "download/trusted_sources_manager_win.cc",
     "engagement/important_sites_usage_counter.cc",
     "engagement/important_sites_usage_counter.h",
     "engagement/important_sites_util.cc",
@@ -501,7 +482,6 @@ static_library("browser") {
     "file_select_helper.h",
     "file_select_helper_contacts_android.cc",
     "file_select_helper_contacts_android.h",
-    "file_select_helper_mac.mm",
     "file_util_service.cc",
     "file_util_service.h",
     "flag_descriptions.cc",
@@ -510,8 +490,6 @@ static_library("browser") {
     "font_pref_change_notifier.h",
     "font_pref_change_notifier_factory.cc",
     "font_pref_change_notifier_factory.h",
-    "fullscreen_mac.mm",
-    "fullscreen_win.cc",
     "games/games_service_factory.cc",
     "games/games_service_factory.h",
     "gcm/gcm_product_util.cc",
@@ -528,10 +506,6 @@ static_library("browser") {
     "geolocation/geolocation_permission_context_delegate_android.h",
     "geolocation/geolocation_permission_context_extensions.cc",
     "geolocation/geolocation_permission_context_extensions.h",
-    "global_keyboard_shortcuts_mac.h",
-    "global_keyboard_shortcuts_mac.mm",
-    "google/did_run_updater_win.cc",
-    "google/did_run_updater_win.h",
     "google/google_brand.cc",
     "google/google_brand.h",
     "google/google_search_domain_mixing_metrics_emitter.cc",
@@ -543,8 +517,6 @@ static_library("browser") {
     "gpu/gpu_mode_manager.cc",
     "gpu/gpu_mode_manager.h",
     "hang_monitor/hang_crash_dump.h",
-    "hang_monitor/hang_crash_dump_mac.cc",
-    "hang_monitor/hang_crash_dump_win.cc",
     "heavy_ad_intervention/heavy_ad_blocklist.cc",
     "heavy_ad_intervention/heavy_ad_blocklist.h",
     "heavy_ad_intervention/heavy_ad_features.cc",
@@ -578,9 +550,6 @@ static_library("browser") {
     "icon_loader.cc",
     "icon_loader.h",
     "icon_loader_android.cc",
-    "icon_loader_chromeos.cc",
-    "icon_loader_mac.mm",
-    "icon_loader_win.cc",
     "icon_manager.cc",
     "icon_manager.h",
     "idle/idle_detection_permission_context.cc",
@@ -593,11 +562,6 @@ static_library("browser") {
     "infobars/infobar_responder.h",
     "infobars/infobar_service.cc",
     "infobars/infobar_service.h",
-    "install_verification/win/module_info.h",
-    "install_verification/win/module_list.cc",
-    "install_verification/win/module_list.h",
-    "install_verification/win/module_verification_common.cc",
-    "install_verification/win/module_verification_common.h",
     "installable/installable_ambient_badge_infobar_delegate.h",
     "installable/installable_data.cc",
     "installable/installable_data.h",
@@ -628,7 +592,6 @@ static_library("browser") {
     "language/url_language_histogram_factory.h",
     "lifetime/application_lifetime.cc",
     "lifetime/application_lifetime.h",
-    "lifetime/application_lifetime_mac.mm",
     "lifetime/browser_shutdown.cc",
     "lifetime/browser_shutdown.h",
     "lookalikes/lookalike_url_blocking_page.cc",
@@ -641,26 +604,6 @@ static_library("browser") {
     "lookalikes/lookalike_url_service.h",
     "lookalikes/lookalike_url_tab_storage.cc",
     "lookalikes/lookalike_url_tab_storage.h",
-    "mac/bluetooth_utility.h",
-    "mac/bluetooth_utility.mm",
-    "mac/dock.h",
-    "mac/dock.mm",
-    "mac/exception_processor.h",
-    "mac/exception_processor.mm",
-    "mac/install_from_dmg.h",
-    "mac/install_from_dmg.mm",
-    "mac/keystone_glue.h",
-    "mac/keystone_glue.mm",
-    "mac/keystone_registration.h",
-    "mac/keystone_registration.mm",
-    "mac/mac_startup_profiler.cc",
-    "mac/mac_startup_profiler.h",
-    "mac/master_prefs.h",
-    "mac/master_prefs.mm",
-    "mac/nsprocessinfo_additions.h",
-    "mac/nsprocessinfo_additions.mm",
-    "mac/relauncher.h",
-    "mac/relauncher.mm",
     "media/cast_mirroring_service_host.cc",
     "media/cast_mirroring_service_host.h",
     "media/cast_remoting_connector.cc",
@@ -777,9 +720,6 @@ static_library("browser") {
     "media/webrtc/webrtc_text_log_handler.cc",
     "media/webrtc/webrtc_text_log_handler.h",
     "media/webrtc/window_icon_util.h",
-    "media/webrtc/window_icon_util_chromeos.cc",
-    "media/webrtc/window_icon_util_mac.mm",
-    "media/webrtc/window_icon_util_win.cc",
     "memory/chrome_browser_main_extra_parts_memory.cc",
     "memory/chrome_browser_main_extra_parts_memory.h",
     "memory/enterprise_memory_limit_evaluator.cc",
@@ -789,18 +729,12 @@ static_library("browser") {
     "memory_details.cc",
     "memory_details.h",
     "memory_details_android.cc",
-    "memory_details_linux.cc",
-    "memory_details_mac.cc",
-    "memory_details_win.cc",
-    "metrics/antivirus_metrics_provider_win.cc",
-    "metrics/antivirus_metrics_provider_win.h",
     "metrics/bluetooth_available_utility.cc",
     "metrics/bluetooth_available_utility.h",
     "metrics/browser_window_histogram_helper.cc",
     "metrics/browser_window_histogram_helper.h",
     "metrics/chrome_browser_main_extra_parts_metrics.cc",
     "metrics/chrome_browser_main_extra_parts_metrics.h",
-    "metrics/chrome_browser_main_extra_parts_metrics_mac.mm",
     "metrics/chrome_feature_list_creator.cc",
     "metrics/chrome_feature_list_creator.h",
     "metrics/chrome_metrics_service_accessor.cc",
@@ -811,14 +745,10 @@ static_library("browser") {
     "metrics/chrome_metrics_services_manager_client.h",
     "metrics/chrome_stability_metrics_provider.cc",
     "metrics/chrome_stability_metrics_provider.h",
-    "metrics/google_update_metrics_provider_win.cc",
-    "metrics/google_update_metrics_provider_win.h",
     "metrics/https_engagement_metrics_provider.cc",
     "metrics/https_engagement_metrics_provider.h",
     "metrics/incognito_observer.cc",
     "metrics/incognito_observer.h",
-    "metrics/jumplist_metrics_win.cc",
-    "metrics/jumplist_metrics_win.h",
     "metrics/metrics_memory_details.cc",
     "metrics/metrics_memory_details.h",
     "metrics/metrics_reporting_state.cc",
@@ -827,8 +757,6 @@ static_library("browser") {
     "metrics/network_quality_estimator_provider_impl.h",
     "metrics/oom/out_of_memory_reporter.cc",
     "metrics/oom/out_of_memory_reporter.h",
-    "metrics/power_metrics_provider_mac.h",
-    "metrics/power_metrics_provider_mac.mm",
     "metrics/process_memory_metrics_emitter.cc",
     "metrics/process_memory_metrics_emitter.h",
     "metrics/renderer_uptime_tracker.cc",
@@ -893,7 +821,6 @@ static_library("browser") {
     "net/file_downloader.cc",
     "net/file_downloader.h",
     "net/net_error_diagnostics_dialog.h",
-    "net/net_error_diagnostics_dialog_win.cc",
     "net/net_error_tab_helper.cc",
     "net/net_error_tab_helper.h",
     "net/net_export_helper.cc",
@@ -920,8 +847,6 @@ static_library("browser") {
     "net/secure_dns_policy_handler.h",
     "net/secure_dns_util.cc",
     "net/secure_dns_util.h",
-    "net/service_providers_win.cc",
-    "net/service_providers_win.h",
     "net/stub_resolver_config_reader.cc",
     "net/stub_resolver_config_reader.h",
     "net/system_network_context_manager.cc",
@@ -932,7 +857,6 @@ static_library("browser") {
     "nfc/nfc_permission_context.h",
     "nfc/nfc_permission_context_android.cc",
     "nfc/nfc_permission_context_android.h",
-    "notifications/alert_dispatcher_mac.h",
     "notifications/metrics/notification_metrics_logger.cc",
     "notifications/metrics/notification_metrics_logger.h",
     "notifications/metrics/notification_metrics_logger_factory.cc",
@@ -955,8 +879,6 @@ static_library("browser") {
     "notifications/notification_permission_context.h",
     "notifications/notification_platform_bridge.cc",
     "notifications/notification_platform_bridge.h",
-    "notifications/notification_platform_bridge_mac.h",
-    "notifications/notification_platform_bridge_mac.mm",
     "notifications/notification_trigger_scheduler.cc",
     "notifications/notification_trigger_scheduler.h",
     "notifications/notification_ui_manager.h",
@@ -1104,10 +1026,6 @@ static_library("browser") {
     "password_manager/chrome_password_manager_client.h",
     "password_manager/field_info_manager_factory.cc",
     "password_manager/field_info_manager_factory.h",
-    "password_manager/password_manager_util_mac.h",
-    "password_manager/password_manager_util_mac.mm",
-    "password_manager/password_manager_util_win.cc",
-    "password_manager/password_manager_util_win.h",
     "password_manager/password_store_factory.cc",
     "password_manager/password_store_factory.h",
     "password_manager/password_store_utils.cc",
@@ -1139,10 +1057,6 @@ static_library("browser") {
     "performance_manager/mechanisms/high_pmf_memory_pressure_signals.h",
     "performance_manager/mechanisms/working_set_trimmer.cc",
     "performance_manager/mechanisms/working_set_trimmer.h",
-    "performance_manager/mechanisms/working_set_trimmer_chromeos.cc",
-    "performance_manager/mechanisms/working_set_trimmer_chromeos.h",
-    "performance_manager/mechanisms/working_set_trimmer_win.cc",
-    "performance_manager/mechanisms/working_set_trimmer_win.h",
     "performance_manager/metrics/memory_pressure_metrics.cc",
     "performance_manager/metrics/memory_pressure_metrics.h",
     "performance_manager/observers/background_metrics_reporter.h",
@@ -1156,12 +1070,6 @@ static_library("browser") {
     "performance_manager/policies/policy_features.h",
     "performance_manager/policies/working_set_trimmer_policy.cc",
     "performance_manager/policies/working_set_trimmer_policy.h",
-    "performance_manager/policies/working_set_trimmer_policy_chromeos.cc",
-    "performance_manager/policies/working_set_trimmer_policy_chromeos.h",
-    "performance_manager/policies/working_set_trimmer_policy_win.cc",
-    "performance_manager/policies/working_set_trimmer_policy_win.h",
-    "performance_monitor/metric_evaluator_helper_win.cc",
-    "performance_monitor/metric_evaluator_helper_win.h",
     "performance_monitor/process_metrics_history.cc",
     "performance_monitor/process_metrics_history.h",
     "performance_monitor/process_monitor.cc",
@@ -1189,10 +1097,7 @@ static_library("browser") {
     "picture_in_picture/picture_in_picture_window_manager.cc",
     "picture_in_picture/picture_in_picture_window_manager.h",
     "platform_util.h",
-    "platform_util_chromeos.cc",
     "platform_util_internal.h",
-    "platform_util_mac.mm",
-    "platform_util_win.cc",
     "plugins/pdf_iframe_navigation_throttle.cc",
     "plugins/pdf_iframe_navigation_throttle.h",
     "plugins/pdf_plugin_placeholder_observer.cc",
@@ -1201,10 +1106,6 @@ static_library("browser") {
     "policy/browser_dm_token_storage.h",
     "policy/browser_dm_token_storage_linux.cc",
     "policy/browser_dm_token_storage_linux.h",
-    "policy/browser_dm_token_storage_mac.h",
-    "policy/browser_dm_token_storage_mac.mm",
-    "policy/browser_dm_token_storage_win.cc",
-    "policy/browser_dm_token_storage_win.h",
     "policy/browsing_history_policy_handler.cc",
     "policy/browsing_history_policy_handler.h",
     "policy/chrome_browser_policy_connector.cc",
@@ -1390,8 +1291,6 @@ static_library("browser") {
     "process_resource_usage.cc",
     "process_resource_usage.h",
     "process_singleton.h",
-    "process_singleton_mac.mm",
-    "process_singleton_win.cc",
     "profiles/avatar_menu_actions.h",
     "profiles/bookmark_model_loaded_observer.cc",
     "profiles/bookmark_model_loaded_observer.h",
@@ -1450,8 +1349,6 @@ static_library("browser") {
     "profiles/profile_metrics.cc",
     "profiles/profile_metrics.h",
     "profiles/profile_observer.h",
-    "profiles/profile_shortcut_manager_win.cc",
-    "profiles/profile_shortcut_manager_win.h",
     "profiles/profiles_state.cc",
     "profiles/profiles_state.h",
     "profiles/renderer_updater.cc",
@@ -1485,10 +1382,6 @@ static_library("browser") {
     "renderer_context_menu/context_menu_content_type_factory.h",
     "renderer_host/chrome_navigation_ui_data.cc",
     "renderer_host/chrome_navigation_ui_data.h",
-    "renderer_host/chrome_render_widget_host_view_mac_delegate.h",
-    "renderer_host/chrome_render_widget_host_view_mac_delegate.mm",
-    "renderer_host/chrome_render_widget_host_view_mac_history_swiper.h",
-    "renderer_host/chrome_render_widget_host_view_mac_history_swiper.mm",
     "renderer_preferences_util.cc",
     "renderer_preferences_util.h",
     "reputation/local_heuristics.cc",
@@ -1642,10 +1535,6 @@ static_library("browser") {
     "shell_integration.cc",
     "shell_integration.h",
     "shell_integration_android.cc",
-    "shell_integration_chromeos.cc",
-    "shell_integration_mac.mm",
-    "shell_integration_win.cc",
-    "shell_integration_win.h",
     "signin/about_signin_internals_factory.cc",
     "signin/about_signin_internals_factory.h",
     "signin/account_consistency_mode_manager.cc",
@@ -1694,8 +1583,6 @@ static_library("browser") {
     "signin/signin_profile_attributes_updater_factory.h",
     "signin/signin_promo_util.cc",
     "signin/signin_promo_util.h",
-    "signin/signin_status_metrics_provider_chromeos.cc",
-    "signin/signin_status_metrics_provider_chromeos.h",
     "signin/signin_util.cc",
     "signin/signin_util.h",
     "site_isolation/prefs_observer.cc",
@@ -1809,8 +1696,6 @@ static_library("browser") {
     "tab_contents/tab_util.h",
     "task_manager/web_contents_tags.cc",
     "task_manager/web_contents_tags.h",
-    "themes/theme_helper_win.cc",
-    "themes/theme_helper_win.h",
     "tracing/background_tracing_field_trial.cc",
     "tracing/background_tracing_field_trial.h",
     "tracing/background_tracing_metrics_provider.cc",
@@ -1872,49 +1757,6 @@ static_library("browser") {
     "wake_lock/wake_lock_permission_context.h",
     "web_data_service_factory.cc",
     "web_data_service_factory.h",
-    "win/app_icon.cc",
-    "win/app_icon.h",
-    "win/automation_controller.cc",
-    "win/automation_controller.h",
-    "win/browser_util.cc",
-    "win/browser_util.h",
-    "win/chrome_elf_init.cc",
-    "win/chrome_elf_init.h",
-    "win/chrome_select_file_dialog_factory.cc",
-    "win/chrome_select_file_dialog_factory.h",
-    "win/conflicts/enumerate_input_method_editors.cc",
-    "win/conflicts/enumerate_input_method_editors.h",
-    "win/conflicts/enumerate_shell_extensions.cc",
-    "win/conflicts/enumerate_shell_extensions.h",
-    "win/conflicts/inspection_results_cache.cc",
-    "win/conflicts/inspection_results_cache.h",
-    "win/conflicts/module_database.cc",
-    "win/conflicts/module_database.h",
-    "win/conflicts/module_database_observer.h",
-    "win/conflicts/module_event_sink_impl.cc",
-    "win/conflicts/module_event_sink_impl.h",
-    "win/conflicts/module_inspector.cc",
-    "win/conflicts/module_inspector.h",
-    "win/conflicts/third_party_metrics_recorder.cc",
-    "win/conflicts/third_party_metrics_recorder.h",
-    "win/jumplist.cc",
-    "win/jumplist.h",
-    "win/jumplist_factory.cc",
-    "win/jumplist_factory.h",
-    "win/jumplist_file_util.cc",
-    "win/jumplist_file_util.h",
-    "win/jumplist_update_util.cc",
-    "win/jumplist_update_util.h",
-    "win/jumplist_updater.cc",
-    "win/jumplist_updater.h",
-    "win/settings_app_monitor.cc",
-    "win/settings_app_monitor.h",
-    "win/taskbar_icon_finder.cc",
-    "win/taskbar_icon_finder.h",
-    "win/titlebar_config.cc",
-    "win/titlebar_config.h",
-    "win/ui_automation_util.cc",
-    "win/ui_automation_util.h",
   ]
 
   configs += [
@@ -3085,7 +2927,6 @@ static_library("browser") {
 
       defines += [ "ENABLE_PASSWORD_CHANGE" ]
     }
-  } else {  # !is_android
     sources += [
       "accessibility/caption_controller.cc",
       "accessibility/caption_controller.h",
@@ -3261,9 +3102,6 @@ static_library("browser") {
       "first_run/first_run.h",
       "first_run/first_run_dialog.h",
       "first_run/first_run_internal.h",
-      "first_run/first_run_internal_linux.cc",
-      "first_run/first_run_internal_mac.mm",
-      "first_run/first_run_internal_win.cc",
       "font_family_cache.cc",
       "font_family_cache.h",
       "hid/chrome_hid_delegate.cc",
@@ -3278,7 +3116,6 @@ static_library("browser") {
       "importer/external_process_importer_host.h",
       "importer/firefox_profile_lock.cc",
       "importer/firefox_profile_lock.h",
-      "importer/firefox_profile_lock_win.cc",
       "importer/importer_list.cc",
       "importer/importer_list.h",
       "importer/importer_lock_dialog.h",
@@ -3315,11 +3152,6 @@ static_library("browser") {
       "media/webrtc/desktop_media_picker_factory_impl.h",
       "media/webrtc/display_media_access_handler.cc",
       "media/webrtc/display_media_access_handler.h",
-      "media/webrtc/media_authorization_wrapper_mac.h",
-      "media/webrtc/system_media_capture_permissions_mac.h",
-      "media/webrtc/system_media_capture_permissions_mac.mm",
-      "media/webrtc/system_media_capture_permissions_stats_mac.h",
-      "media/webrtc/system_media_capture_permissions_stats_mac.mm",
       "media/webrtc/tab_desktop_media_list.cc",
       "media/webrtc/tab_desktop_media_list.h",
       "media_galleries/fileapi/av_scanning_file_validator.cc",
@@ -3361,8 +3193,6 @@ static_library("browser") {
       "memory/swap_thrashing_monitor.h",
       "memory/swap_thrashing_monitor_delegate.cc",
       "memory/swap_thrashing_monitor_delegate.h",
-      "memory/swap_thrashing_monitor_delegate_win.cc",
-      "memory/swap_thrashing_monitor_delegate_win.h",
       "metrics/browser_activity_watcher.cc",
       "metrics/browser_activity_watcher.h",
       "metrics/desktop_platform_features_metrics_provider.cc",
@@ -3381,14 +3211,11 @@ static_library("browser") {
       "metrics/desktop_session_duration/desktop_session_duration_tracker.h",
       "metrics/first_web_contents_profiler.cc",
       "metrics/first_web_contents_profiler.h",
-      "metrics/incognito_observer_desktop.cc",
       "metrics/tab_stats_data_store.cc",
       "metrics/tab_stats_data_store.h",
       "metrics/tab_stats_tracker.cc",
       "metrics/tab_stats_tracker.h",
       "metrics/tab_stats_tracker_delegate.h",
-      "metrics/tab_stats_tracker_delegate_win.cc",
-      "metrics/tab_stats_tracker_win.cc",
       "nearby_sharing/nearby_sharing_prefs.cc",
       "nearby_sharing/nearby_sharing_prefs.h",
       "nearby_sharing/nearby_sharing_service.h",
@@ -3402,8 +3229,6 @@ static_library("browser") {
       "notifications/profile_notification.h",
       "obsolete_system/obsolete_system.h",
       "obsolete_system/obsolete_system_linux.cc",
-      "obsolete_system/obsolete_system_mac.cc",
-      "obsolete_system/obsolete_system_win.cc",
       "page_load_metrics/observers/session_restore_page_load_metrics_observer.cc",
       "page_load_metrics/observers/session_restore_page_load_metrics_observer.h",
       "performance_manager/mechanisms/page_discarder.cc",
@@ -3446,21 +3271,12 @@ static_library("browser") {
       "profile_resetter/triggered_profile_resetter.h",
       "profile_resetter/triggered_profile_resetter_factory.cc",
       "profile_resetter/triggered_profile_resetter_factory.h",
-      "profile_resetter/triggered_profile_resetter_win.cc",
       "profiles/profile_shortcut_manager.cc",
       "profiles/profile_shortcut_manager.h",
       "profiles/profile_window.cc",
       "profiles/profile_window.h",
       "renderer_context_menu/accessibility_labels_bubble_model.cc",
       "renderer_context_menu/accessibility_labels_bubble_model.h",
-      "renderer_context_menu/accessibility_labels_menu_observer.cc",
-      "renderer_context_menu/accessibility_labels_menu_observer.h",
-      "renderer_context_menu/render_view_context_menu.cc",
-      "renderer_context_menu/render_view_context_menu.h",
-      "renderer_context_menu/spelling_bubble_model.cc",
-      "renderer_context_menu/spelling_bubble_model.h",
-      "renderer_context_menu/spelling_menu_observer.cc",
-      "renderer_context_menu/spelling_menu_observer.h",
       "repost_form_warning_controller.cc",
       "repost_form_warning_controller.h",
       "resource_coordinator/background_tab_navigation_throttle.cc",
@@ -3516,8 +3332,6 @@ static_library("browser") {
       "resource_coordinator/tab_lifecycle_unit_source.h",
       "resource_coordinator/tab_manager.cc",
       "resource_coordinator/tab_manager.h",
-      "resource_coordinator/tab_manager_delegate_chromeos.cc",
-      "resource_coordinator/tab_manager_delegate_chromeos.h",
       "resource_coordinator/tab_manager_resource_coordinator_signal_observer.cc",
       "resource_coordinator/tab_manager_resource_coordinator_signal_observer.h",
       "resource_coordinator/tab_manager_stats_collector.cc",
@@ -3600,16 +3414,6 @@ static_library("browser") {
       "serial/serial_chooser_context.h",
       "serial/serial_chooser_context_factory.cc",
       "serial/serial_chooser_context_factory.h",
-      "sharing/click_to_call/click_to_call_context_menu_observer.cc",
-      "sharing/click_to_call/click_to_call_context_menu_observer.h",
-      "sharing/click_to_call/click_to_call_metrics.cc",
-      "sharing/click_to_call/click_to_call_metrics.h",
-      "sharing/click_to_call/click_to_call_ui_controller.cc",
-      "sharing/click_to_call/click_to_call_ui_controller.h",
-      "sharing/click_to_call/click_to_call_utils.cc",
-      "sharing/click_to_call/click_to_call_utils.h",
-      "sharing/click_to_call/phone_number_regex.cc",
-      "sharing/click_to_call/phone_number_regex.h",
       "sharing/shared_clipboard/remote_copy_message_handler.cc",
       "sharing/shared_clipboard/remote_copy_message_handler.h",
       "sharing/shared_clipboard/shared_clipboard_context_menu_observer.cc",
@@ -3737,8 +3541,6 @@ static_library("browser") {
       "task_manager/providers/worker_task_provider.cc",
       "task_manager/providers/worker_task_provider.h",
       "task_manager/sampling/shared_sampler.h",
-      "task_manager/sampling/shared_sampler_win.cc",
-      "task_manager/sampling/shared_sampler_win_defines.h",
       "task_manager/sampling/task_group.cc",
       "task_manager/sampling/task_group.h",
       "task_manager/sampling/task_group_sampler.cc",
@@ -3767,6 +3569,7 @@ static_library("browser") {
       "upgrade_detector/build_state.cc",
       "upgrade_detector/build_state.h",
       "upgrade_detector/build_state_observer.h",
+      "upgrade_detector/get_installed_version_linux.cc",
       "upgrade_detector/upgrade_detector.cc",
       "upgrade_detector/upgrade_detector.h",
       "upgrade_detector/upgrade_observer.h",
@@ -3789,6 +3592,10 @@ static_library("browser") {
       "webauthn/observable_authenticator_list.cc",
       "webauthn/observable_authenticator_list.h",
     ]
+    sources -= [
+      "banners/app_banner_manager_desktop.cc",
+      "banners/app_banner_manager_desktop.h",
+    ]
     deps += [
       ":theme_properties",
       "//base/util/memory_pressure",
@@ -3799,7 +3606,6 @@ static_library("browser") {
       "//chrome/browser/profile_resetter:profile_reset_report_proto",
       "//chrome/browser/resource_coordinator:intervention_policy_database_proto",
       "//chrome/browser/resource_coordinator:tab_metrics_event_proto",
-      "//chrome/browser/resource_coordinator/tab_ranker",
       "//chrome/browser/resources:component_extension_resources",
       "//chrome/browser/search:generated",
       "//chrome/common/importer:interfaces",
@@ -3833,7 +3639,6 @@ static_library("browser") {
         "chrome_browser_main_posix.h",
         "first_run/first_run_internal_posix.cc",
         "importer/firefox_profile_lock_posix.cc",
-        "process_singleton_posix.cc",
         "task_manager/sampling/shared_sampler_posix.cc",
       ]
     }
@@ -3945,8 +3750,6 @@ static_library("browser") {
       "notifications/web_page_notifier_controller.h",
       "policy/default_geolocation_policy_handler.cc",
       "policy/default_geolocation_policy_handler.h",
-      "renderer_context_menu/quick_answers_menu_observer.cc",
-      "renderer_context_menu/quick_answers_menu_observer.h",
       "speech/tts_chromeos.cc",
       "speech/tts_chromeos.h",
       "sync/sync_error_notifier_ash.cc",
@@ -4348,15 +4151,12 @@ static_library("browser") {
     ]
   }
 
-  if (!is_android && !is_chromeos) {
+  if (is_android && !is_chromeos) {
     sources += [
       "device_identity/device_oauth2_token_store_desktop.cc",
       "device_identity/device_oauth2_token_store_desktop.h",
       "first_run/upgrade_util.cc",
       "first_run/upgrade_util.h",
-      "first_run/upgrade_util_mac.cc",
-      "first_run/upgrade_util_win.cc",
-      "first_run/upgrade_util_win.h",
       "lifetime/switch_utils.cc",
       "lifetime/switch_utils.h",
       "metrics/upgrade_metrics_provider.cc",
@@ -4378,8 +4178,6 @@ static_library("browser") {
       "policy/chrome_browser_cloud_management_register_watcher.h",
       "policy/cloud/chrome_browser_cloud_management_helper.cc",
       "policy/cloud/chrome_browser_cloud_management_helper.h",
-      "policy/cloud/user_policy_signin_service.cc",
-      "policy/cloud/user_policy_signin_service.h",
       "policy/cloud/user_policy_signin_service_internal.h",
       "profiles/avatar_menu.cc",
       "profiles/avatar_menu.h",
@@ -4408,14 +4206,12 @@ static_library("browser") {
       "signin/signin_global_error_factory.h",
       "upgrade_detector/get_installed_version.cc",
       "upgrade_detector/get_installed_version.h",
-      "upgrade_detector/get_installed_version_mac.mm",
-      "upgrade_detector/get_installed_version_win.cc",
       "upgrade_detector/installed_version_poller.cc",
       "upgrade_detector/installed_version_poller.h",
       "upgrade_detector/upgrade_detector_impl.cc",
       "upgrade_detector/upgrade_detector_impl.h",
     ]
-  } else {  # is_android || is_chromeos
+
     sources += [
       "installable/digital_asset_links/digital_asset_links_handler.cc",
       "installable/digital_asset_links/digital_asset_links_handler.h",
@@ -4523,7 +4319,7 @@ static_library("browser") {
       sources -= [ "background/background_mode_manager_aura.cc" ]
     }
   }
-  if (enable_background_contents) {
+  if (true) {
     sources += [
       "background/background_contents_service.cc",
       "background/background_contents_service.h",
@@ -4548,9 +4344,6 @@ static_library("browser") {
       "printing/print_view_manager_common.cc",
       "printing/print_view_manager_common.h",
       "printing/printer_manager_dialog.h",
-      "printing/printer_manager_dialog_linux.cc",
-      "printing/printer_manager_dialog_mac.mm",
-      "printing/printer_manager_dialog_win.cc",
       "printing/printer_query.cc",
       "printing/printer_query.h",
       "printing/printing_init.cc",
@@ -5302,7 +5095,7 @@ static_library("browser") {
     }
   }
 
-  if (enable_session_service) {
+  if (true) {
     sources += [
       "sessions/session_restore.cc",
       "sessions/session_restore.h",
@@ -5668,7 +5461,7 @@ grit("resources") {
     }
   }
 
-  if (is_win || is_mac || is_desktop_linux || is_chromeos) {
+  if (is_win || is_mac || is_desktop_linux || is_chromeos || is_android) {
     deps += [
       "//chrome/browser/resources/discards:discards_resources_gen",
       "//chrome/browser/resources/gaia_auth_host:modulize",
--- a/chrome/browser/ui/BUILD.gn
+++ b/chrome/browser/ui/BUILD.gn
@@ -611,7 +611,7 @@ static_library("ui") {
   allow_circular_includes_from +=
       [ "//chrome/browser/ui/webui/bluetooth_internals" ]
 
-  if (is_win || is_mac || is_desktop_linux || is_chromeos) {
+  if (is_win || is_mac || is_desktop_linux || is_chromeos || is_android) {
     deps += [ "//chrome/browser/ui/webui/discards:mojo_bindings" ]
   }
 
@@ -850,8 +850,6 @@ static_library("ui") {
       "//services/device/public/mojom:usb",
       "//ui/android",
     ]
-  } else {
-    # !is_android
     sources += [
       "apps/app_info_dialog.h",
       "apps/chrome_app_delegate.cc",
@@ -860,6 +858,8 @@ static_library("ui") {
       "apps/chrome_app_window_client.h",
       "apps/directory_access_confirmation_dialog.cc",
       "apps/directory_access_confirmation_dialog.h",
+      "aura/native_window_tracker_aura.cc",
+      "aura/native_window_tracker_aura.h",
       "blocked_content/framebust_block_tab_helper.cc",
       "blocked_content/framebust_block_tab_helper.h",
       "blocked_content/popunder_preventer.cc",
@@ -914,7 +914,6 @@ static_library("ui") {
       "browser_location_bar_model_delegate.h",
       "browser_navigator.cc",
       "browser_navigator.h",
-      "browser_otr_state.cc",
       "browser_otr_state.h",
       "browser_tab_restorer.cc",
       "browser_tab_strip_model_delegate.cc",
@@ -1004,12 +1003,6 @@ static_library("ui") {
       "global_media_controls/overlay_media_notification.h",
       "global_media_controls/overlay_media_notifications_manager.cc",
       "global_media_controls/overlay_media_notifications_manager.h",
-      "hats/hats_helper.cc",
-      "hats/hats_helper.h",
-      "hats/hats_service.cc",
-      "hats/hats_service.h",
-      "hats/hats_service_factory.cc",
-      "hats/hats_service_factory.h",
       "hats/hats_survey_status_checker.cc",
       "hats/hats_survey_status_checker.h",
       "hid/hid_chooser.cc",
@@ -1165,8 +1158,6 @@ static_library("ui") {
       "singleton_tabs.h",
       "startup/automation_infobar_delegate.cc",
       "startup/automation_infobar_delegate.h",
-      "startup/google_api_keys_infobar_delegate.cc",
-      "startup/google_api_keys_infobar_delegate.h",
       "startup/obsolete_system_infobar_delegate.cc",
       "startup/obsolete_system_infobar_delegate.h",
       "startup/startup_browser_creator.cc",
@@ -1241,10 +1232,6 @@ static_library("ui") {
       "tabs/tab_types.h",
       "tabs/tab_utils.cc",
       "tabs/tab_utils.h",
-      "task_manager/task_manager_columns.cc",
-      "task_manager/task_manager_columns.h",
-      "task_manager/task_manager_table_model.cc",
-      "task_manager/task_manager_table_model.h",
       "thumbnails/thumbnail_image.cc",
       "thumbnails/thumbnail_image.h",
       "thumbnails/thumbnail_readiness_tracker.cc",
@@ -1385,8 +1372,6 @@ static_library("ui") {
       "webui/settings/extension_control_handler.h",
       "webui/settings/font_handler.cc",
       "webui/settings/font_handler.h",
-      "webui/settings/hats_handler.cc",
-      "webui/settings/hats_handler.h",
       "webui/settings/import_data_handler.cc",
       "webui/settings/import_data_handler.h",
       "webui/settings/languages_handler.cc",
@@ -1461,6 +1446,7 @@ static_library("ui") {
       "webui/theme_source.h",
       "webui/web_footer_experiment_ui.cc",
       "webui/web_footer_experiment_ui.h",
+      "window_sizer/window_sizer_aura.cc",
       "window_sizer/window_sizer.cc",
       "window_sizer/window_sizer.h",
       "zoom/chrome_zoom_level_otr_delegate.cc",
@@ -1475,7 +1461,6 @@ static_library("ui") {
       "//chrome/browser/media/router",
       "//chrome/browser/profile_resetter:profile_reset_report_proto",
       "//chrome/browser/resource_coordinator:tab_metrics_event_proto",
-      "//chrome/browser/resource_coordinator/tab_ranker",
       "//chrome/browser/safe_browsing:advanced_protection",
       "//chrome/browser/ui/color:color_headers",
       "//chrome/browser/ui/color:mixers",
@@ -2230,7 +2215,7 @@ static_library("ui") {
     }
   }
 
-  if (is_win || is_mac || is_desktop_linux || is_chromeos) {
+  if (is_win || is_mac || is_desktop_linux || is_chromeos || is_android) {
     sources += [
       "autofill/payments/virtual_card_selection_dialog_controller.h",
       "autofill/payments/virtual_card_selection_dialog_controller_impl.cc",
@@ -2277,10 +2262,6 @@ static_library("ui") {
       "views/profiles/profile_menu_view_base.h",
       "views/profiles/signin_view_controller_delegate_views.cc",
       "views/profiles/signin_view_controller_delegate_views.h",
-      "webui/discards/discards_ui.cc",
-      "webui/discards/discards_ui.h",
-      "webui/discards/graph_dump_impl.cc",
-      "webui/discards/graph_dump_impl.h",
       "webui/discards/site_data_provider_impl.cc",
       "webui/discards/site_data_provider_impl.h",
       "webui/signin/inline_login_handler.cc",
@@ -2297,7 +2278,7 @@ static_library("ui") {
     deps += [ "//ui/webui" ]
   }
 
-  if (is_win || is_mac || is_desktop_linux) {
+  if (is_win || is_mac || is_linux || is_android) {
     sources += [
       "bookmarks/bookmark_bubble_sign_in_delegate.cc",
       "bookmarks/bookmark_bubble_sign_in_delegate.h",
@@ -2311,10 +2292,7 @@ static_library("ui") {
       "sync/one_click_signin_links_delegate_impl.h",
       "user_manager.cc",
       "user_manager.h",
-      "views/external_protocol_dialog.cc",
       "views/external_protocol_dialog.h",
-      "views/profiles/badged_profile_photo.cc",
-      "views/profiles/badged_profile_photo.h",
       "views/profiles/profile_picker_view.cc",
       "views/profiles/profile_picker_view.h",
       "views/profiles/user_manager_view.cc",
@@ -2687,14 +2665,11 @@ static_library("ui") {
     }
   }
 
-  if (is_desktop_linux) {
+  if (is_desktop_linux || is_android) {
     sources += [
       "views/apps/chrome_app_window_client_views_linux.cc",
       "views/first_run_dialog.cc",
       "views/first_run_dialog.h",
-      "views/frame/browser_desktop_window_tree_host.h",
-      "views/frame/desktop_browser_frame_aura_linux.cc",
-      "views/frame/desktop_browser_frame_aura_linux.h",
       "views/status_icons/status_icon_button_linux.cc",
       "views/status_icons/status_icon_button_linux.h",
       "views/status_icons/status_icon_linux_wrapper.cc",
@@ -2704,9 +2679,6 @@ static_library("ui") {
       "webui/settings_utils_linux.cc",
     ]
     deps += [
-      "//ui/base:wm_role_names",
-      "//ui/base/ime",
-      "//ui/events:dom_keycode_converter",
     ]
 
     if (use_dbus) {
@@ -2789,7 +2761,7 @@ static_library("ui") {
     ]
   }
 
-  if (toolkit_views) {
+  if (true) {
     sources += [
       "autofill/payments/local_card_migration_bubble.h",
       "autofill/payments/local_card_migration_bubble_controller_impl.cc",
@@ -2827,6 +2799,7 @@ static_library("ui") {
       # This test header is included because it contains forward declarations
       # needed for "friend" statements for use in tests.
       "translate/translate_bubble_test_utils.h",
+      "views/accelerator_utils_aura.cc",
       "views/accessibility/caption_bubble.cc",
       "views/accessibility/caption_bubble.h",
       "views/accessibility/caption_bubble_controller_views.cc",
@@ -2861,12 +2834,8 @@ static_library("ui") {
       "views/autofill/autofill_bubble_handler_impl.h",
       "views/autofill/autofill_popup_base_view.cc",
       "views/autofill/autofill_popup_base_view.h",
-      "views/autofill/autofill_popup_view_native_views.cc",
-      "views/autofill/autofill_popup_view_native_views.h",
       "views/autofill/autofill_popup_view_utils.cc",
       "views/autofill/autofill_popup_view_utils.h",
-      "views/autofill/payments/card_unmask_prompt_views.cc",
-      "views/autofill/payments/card_unmask_prompt_views.h",
       "views/autofill/payments/dialog_view_ids.h",
       "views/autofill/payments/local_card_migration_bubble_views.cc",
       "views/autofill/payments/local_card_migration_bubble_views.h",
@@ -2919,8 +2888,6 @@ static_library("ui") {
       "views/bulleted_label_list_view.h",
       "views/certificate_selector.cc",
       "views/certificate_selector.h",
-      "views/chrome_browser_main_extra_parts_views.cc",
-      "views/chrome_browser_main_extra_parts_views.h",
       "views/chrome_constrained_window_views_client.cc",
       "views/chrome_constrained_window_views_client.h",
       "views/chrome_layout_provider.cc",
@@ -2969,6 +2936,7 @@ static_library("ui") {
       "views/download/download_shelf_view.cc",
       "views/download/download_shelf_view.h",
       "views/download/download_started_animation_views.cc",
+      "views/dropdown_bar_host_aura.cc",
       "views/dropdown_bar_host.cc",
       "views/dropdown_bar_host.h",
       "views/dropdown_bar_host_delegate.h",
@@ -3017,8 +2985,6 @@ static_library("ui") {
       "views/find_bar_host.h",
       "views/find_bar_view.cc",
       "views/find_bar_view.h",
-      "views/folder_upload_confirmation_view.cc",
-      "views/folder_upload_confirmation_view.h",
       "views/frame/app_menu_button.cc",
       "views/frame/app_menu_button.h",
       "views/frame/app_menu_button_observer.h",
@@ -3026,6 +2992,7 @@ static_library("ui") {
       "views/frame/browser_frame.h",
       "views/frame/browser_non_client_frame_view.cc",
       "views/frame/browser_non_client_frame_view.h",
+      "views/frame/browser_non_client_frame_view_factory_views.cc",
       "views/frame/browser_root_view.cc",
       "views/frame/browser_root_view.h",
       "views/frame/browser_view.cc",
@@ -3040,12 +3007,15 @@ static_library("ui") {
       "views/frame/contents_layout_manager.h",
       "views/frame/contents_web_view.cc",
       "views/frame/contents_web_view.h",
+      "views/frame/desktop_browser_frame_aura.cc",
+      "views/frame/desktop_browser_frame_aura.h",
       "views/frame/immersive_mode_controller.cc",
       "views/frame/immersive_mode_controller.h",
       "views/frame/immersive_mode_controller_factory_views.cc",
       "views/frame/immersive_mode_controller_stub.cc",
       "views/frame/immersive_mode_controller_stub.h",
       "views/frame/native_browser_frame.h",
+      "views/frame/native_browser_frame_factory_aurax11.cc",
       "views/frame/native_browser_frame_factory.cc",
       "views/frame/native_browser_frame_factory.h",
       "views/frame/system_menu_model_builder.cc",
@@ -3098,8 +3068,6 @@ static_library("ui") {
       "views/importer/import_lock_dialog_view.h",
       "views/infobars/alternate_nav_infobar_view.cc",
       "views/infobars/alternate_nav_infobar_view.h",
-      "views/infobars/confirm_infobar.cc",
-      "views/infobars/confirm_infobar.h",
       "views/infobars/infobar_container_view.cc",
       "views/infobars/infobar_container_view.h",
       "views/infobars/infobar_view.cc",
@@ -3159,12 +3127,8 @@ static_library("ui") {
       "views/media_router/cast_dialog_view.h",
       "views/media_router/cast_toolbar_button.cc",
       "views/media_router/cast_toolbar_button.h",
-      "views/media_router/cloud_services_dialog_view.cc",
-      "views/media_router/cloud_services_dialog_view.h",
       "views/media_router/media_remoting_dialog_view.cc",
       "views/media_router/media_remoting_dialog_view.h",
-      "views/media_router/media_router_dialog_controller_views.cc",
-      "views/media_router/media_router_dialog_controller_views.h",
       "views/media_router/media_router_views_ui.cc",
       "views/media_router/media_router_views_ui.h",
       "views/media_router/presentation_receiver_window_factory.cc",
@@ -3174,16 +3138,8 @@ static_library("ui") {
       "views/media_router/presentation_receiver_window_view.h",
       "views/media_router/web_contents_display_observer_view.cc",
       "views/media_router/web_contents_display_observer_view.h",
-      "views/message_box_dialog.cc",
-      "views/message_box_dialog.h",
       "views/native_file_system/native_file_system_access_icon_view.cc",
       "views/native_file_system/native_file_system_access_icon_view.h",
-      "views/native_file_system/native_file_system_directory_access_confirmation_view.cc",
-      "views/native_file_system/native_file_system_directory_access_confirmation_view.h",
-      "views/native_file_system/native_file_system_permission_view.cc",
-      "views/native_file_system/native_file_system_permission_view.h",
-      "views/native_file_system/native_file_system_restricted_directory_dialog_view.cc",
-      "views/native_file_system/native_file_system_restricted_directory_dialog_view.h",
       "views/native_file_system/native_file_system_ui_helpers.cc",
       "views/native_file_system/native_file_system_ui_helpers.h",
       "views/native_file_system/native_file_system_usage_bubble_view.cc",
@@ -3214,8 +3170,6 @@ static_library("ui") {
       "views/overlay/back_to_tab_image_button.h",
       "views/overlay/close_image_button.cc",
       "views/overlay/close_image_button.h",
-      "views/overlay/overlay_window_views.cc",
-      "views/overlay/overlay_window_views.h",
       "views/overlay/playback_image_button.cc",
       "views/overlay/playback_image_button.h",
       "views/overlay/resize_handle_button.cc",
@@ -3250,8 +3204,6 @@ static_library("ui") {
       "views/page_info/permission_selector_row.cc",
       "views/page_info/permission_selector_row.h",
       "views/page_info/permission_selector_row_observer.h",
-      "views/page_info/safety_tip_page_info_bubble_view.cc",
-      "views/page_info/safety_tip_page_info_bubble_view.h",
       "views/passwords/account_chooser_dialog_view.cc",
       "views/passwords/account_chooser_dialog_view.h",
       "views/passwords/auto_signin_first_run_dialog_view.cc",
@@ -3270,8 +3222,6 @@ static_library("ui") {
       "views/passwords/password_bubble_view_base.h",
       "views/passwords/password_generation_confirmation_view.cc",
       "views/passwords/password_generation_confirmation_view.h",
-      "views/passwords/password_generation_popup_view_views.cc",
-      "views/passwords/password_generation_popup_view_views.h",
       "views/passwords/password_items_view.cc",
       "views/passwords/password_items_view.h",
       "views/passwords/password_save_unsynced_credentials_locally_view.cc",
@@ -3330,8 +3280,6 @@ static_library("ui") {
       "views/permission_bubble/chooser_bubble_ui.cc",
       "views/permission_bubble/permission_prompt_bubble_view.cc",
       "views/permission_bubble/permission_prompt_bubble_view.h",
-      "views/permission_bubble/permission_prompt_impl.cc",
-      "views/permission_bubble/permission_prompt_impl.h",
       "views/profiles/avatar_toolbar_button.cc",
       "views/profiles/avatar_toolbar_button.h",
       "views/profiles/avatar_toolbar_button_delegate.cc",
@@ -3606,8 +3554,6 @@ static_library("ui") {
       sources += [
         "views/create_application_shortcut_view.cc",
         "views/create_application_shortcut_view.h",
-        "views/ssl_client_certificate_selector.cc",
-        "views/ssl_client_certificate_selector.h",
       ]
     }
 
@@ -3676,9 +3622,6 @@ static_library("ui") {
         "views/relaunch_notification/relaunch_recommended_timer.h",
         "views/relaunch_notification/relaunch_required_dialog_view.cc",
         "views/relaunch_notification/relaunch_required_dialog_view.h",
-        "views/screen_capture_notification_ui_views.cc",
-        "views/sync/dice_bubble_sync_promo_view.cc",
-        "views/sync/dice_bubble_sync_promo_view.h",
         "views/sync/dice_signin_button_view.cc",
         "views/sync/dice_signin_button_view.h",
       ]
@@ -4227,7 +4170,7 @@ static_library("ui") {
       "//components/printing/browser",
       "//printing",
     ]
-    if (!is_chromeos && !is_android) {
+    if (!is_chromeos && is_android) {
       sources += [
         "webui/settings/printing_handler.cc",
         "webui/settings/printing_handler.h",
--- a/content/public/browser/BUILD.gn
+++ b/content/public/browser/BUILD.gn
@@ -504,7 +504,7 @@ jumbo_source_set("browser_sources") {
     sources += [ "remote_cocoa.h" ]
   }
 
-  if (!is_android) {
+  if (is_android) {
     sources += [
       "host_zoom_map.h",
       "zoom_level_delegate.h",
--- a/content/browser/BUILD.gn
+++ b/content/browser/BUILD.gn
@@ -2510,7 +2510,7 @@ jumbo_source_set("browser") {
     }
     defines += [ "APPCACHE_USE_SIMPLE_CACHE" ]
     libs += [ "jnigraphics" ]
-  } else {
+
     # Not Android.
     sources += [
       # The WebAuthn devtools protocol API is not supported in Android yet.
--- a/chrome/renderer/BUILD.gn
+++ b/chrome/renderer/BUILD.gn
@@ -421,6 +421,8 @@ static_library("renderer") {
       "net/page_auto_fetcher_helper_android.cc",
       "net/page_auto_fetcher_helper_android.h",
     ]
+
+    deps += [ "//chrome/common/search:generate_chrome_colors_info" ]
   }
 
   if (is_chromeos) {
--- a/chrome/common/BUILD.gn
+++ b/chrome/common/BUILD.gn
@@ -419,7 +419,6 @@ static_library("common") {
       "media/chrome_media_drm_bridge_client.cc",
       "media/chrome_media_drm_bridge_client.h",
     ]
-  } else {
     # Non-Android.
     public_deps += [ "//chrome/common/importer" ]
   }
@@ -713,7 +712,6 @@ mojom("mojo_bindings") {
 
   if (is_android) {
     sources += [ "sandbox_status_extension_android.mojom" ]
-  } else {
     sources += [ "caption.mojom" ]
   }
 
--- a/chrome/browser/extensions/BUILD.gn
+++ b/chrome/browser/extensions/BUILD.gn
@@ -13,6 +13,8 @@ import("//rlz/buildflags/buildflags.gni"
 
 assert(enable_extensions)
 
+set_sources_assignment_filter([])
+
 static_library("extensions") {
   sources = [
     # TODO These references to files in //chrome/browser/ should either be
@@ -164,8 +166,6 @@ static_library("extensions") {
     "api/extension_action/extension_page_actions_api_constants.h",
     "api/feedback_private/chrome_feedback_private_delegate.cc",
     "api/feedback_private/chrome_feedback_private_delegate.h",
-    "api/file_handlers/non_native_file_system_delegate_chromeos.cc",
-    "api/file_handlers/non_native_file_system_delegate_chromeos.h",
     "api/file_system/chrome_file_system_delegate.cc",
     "api/file_system/chrome_file_system_delegate.h",
     "api/file_system/file_entry_picker.cc",
@@ -216,14 +216,10 @@ static_library("extensions") {
     "api/image_writer_private/image_writer_utility_client.h",
     "api/image_writer_private/operation.cc",
     "api/image_writer_private/operation.h",
-    "api/image_writer_private/operation_chromeos.cc",
     "api/image_writer_private/operation_manager.cc",
     "api/image_writer_private/operation_manager.h",
     "api/image_writer_private/removable_storage_provider.cc",
     "api/image_writer_private/removable_storage_provider.h",
-    "api/image_writer_private/removable_storage_provider_chromeos.cc",
-    "api/image_writer_private/removable_storage_provider_mac.cc",
-    "api/image_writer_private/removable_storage_provider_win.cc",
     "api/image_writer_private/unzip_helper.cc",
     "api/image_writer_private/unzip_helper.h",
     "api/image_writer_private/write_from_file_operation.cc",
@@ -256,8 +252,6 @@ static_library("extensions") {
     "api/metrics_private/chrome_metrics_private_delegate.h",
     "api/module/module.cc",
     "api/module/module.h",
-    "api/networking_private/networking_private_ui_delegate_chromeos.cc",
-    "api/networking_private/networking_private_ui_delegate_chromeos.h",
     "api/networking_private/networking_private_ui_delegate_factory_impl.cc",
     "api/networking_private/networking_private_ui_delegate_factory_impl.h",
     "api/notifications/extension_notification_display_helper.cc",
@@ -392,7 +386,6 @@ static_library("extensions") {
     "api/tabs/tabs_event_router.cc",
     "api/tabs/tabs_event_router.h",
     "api/tabs/tabs_util.h",
-    "api/tabs/tabs_util_chromeos.cc",
     "api/tabs/tabs_windows_api.cc",
     "api/tabs/tabs_windows_api.h",
     "api/tabs/windows_event_router.cc",
@@ -476,8 +469,6 @@ static_library("extensions") {
     "chrome_url_request_util.h",
     "chrome_zipfile_installer.cc",
     "chrome_zipfile_installer.h",
-    "clipboard_extension_helper_chromeos.cc",
-    "clipboard_extension_helper_chromeos.h",
     "component_extensions_whitelist/whitelist.cc",
     "component_extensions_whitelist/whitelist.h",
     "component_loader.cc",
@@ -514,8 +505,6 @@ static_library("extensions") {
     "extension_action_storage_manager.h",
     "extension_assets_manager.cc",
     "extension_assets_manager.h",
-    "extension_assets_manager_chromeos.cc",
-    "extension_assets_manager_chromeos.h",
     "extension_browser_window_helper.cc",
     "extension_browser_window_helper.h",
     "extension_checkup.cc",
@@ -533,8 +522,6 @@ static_library("extensions") {
     "extension_error_ui_default.h",
     "extension_garbage_collector.cc",
     "extension_garbage_collector.h",
-    "extension_garbage_collector_chromeos.cc",
-    "extension_garbage_collector_chromeos.h",
     "extension_garbage_collector_factory.cc",
     "extension_garbage_collector_factory.h",
     "extension_gcm_app_handler.cc",
@@ -608,8 +595,6 @@ static_library("extensions") {
     "external_pref_loader.h",
     "external_provider_impl.cc",
     "external_provider_impl.h",
-    "external_registry_loader_win.cc",
-    "external_registry_loader_win.h",
     "forced_extensions/installation_metrics.cc",
     "forced_extensions/installation_metrics.h",
     "forced_extensions/installation_reporter.cc",
@@ -620,10 +605,8 @@ static_library("extensions") {
     "forced_extensions/installation_tracker.h",
     "global_shortcut_listener.cc",
     "global_shortcut_listener.h",
-    "global_shortcut_listener_mac.h",
-    "global_shortcut_listener_mac.mm",
-    "global_shortcut_listener_win.cc",
-    "global_shortcut_listener_win.h",
+    "global_shortcut_listener_ozone.cc",
+    "global_shortcut_listener_ozone.h",
     "install_gate.h",
     "install_observer.cc",
     "install_observer.h",
@@ -690,12 +673,8 @@ static_library("extensions") {
     "sync_bundle.cc",
     "sync_bundle.h",
     "system_display/display_info_provider.h",
-    "system_display/display_info_provider_chromeos.cc",
-    "system_display/display_info_provider_chromeos.h",
-    "system_display/display_info_provider_mac.cc",
-    "system_display/display_info_provider_mac.h",
-    "system_display/display_info_provider_win.cc",
-    "system_display/display_info_provider_win.h",
+    "system_display/display_info_provider_aura.cc",
+    "system_display/display_info_provider_aura.h",
     "tab_helper.cc",
     "tab_helper.h",
     "theme_installed_infobar_delegate.cc",
@@ -1055,10 +1034,6 @@ static_library("extensions") {
       "api/enterprise_reporting_private/device_info_fetcher.h",
       "api/enterprise_reporting_private/device_info_fetcher_linux.cc",
       "api/enterprise_reporting_private/device_info_fetcher_linux.h",
-      "api/enterprise_reporting_private/device_info_fetcher_mac.h",
-      "api/enterprise_reporting_private/device_info_fetcher_mac.mm",
-      "api/enterprise_reporting_private/device_info_fetcher_win.cc",
-      "api/enterprise_reporting_private/device_info_fetcher_win.h",
       "api/enterprise_reporting_private/enterprise_reporting_private_api.cc",
       "api/enterprise_reporting_private/enterprise_reporting_private_api.h",
       "api/enterprise_reporting_private/prefs.cc",
@@ -1071,7 +1046,6 @@ static_library("extensions") {
       "api/messaging/native_messaging_launch_from_native.h",
       "api/messaging/native_process_launcher.cc",
       "api/messaging/native_process_launcher.h",
-      "api/messaging/native_process_launcher_win.cc",
       "api/tabs/tabs_util.cc",
       "chrome_kiosk_delegate.cc",
       "default_apps.cc",
@@ -1117,7 +1091,7 @@ static_library("extensions") {
     }
   }
 
-  if (!is_android) {
+  if (is_android) {
     sources += [
       "api/processes/processes_api.cc",
       "api/processes/processes_api.h",
--- a/chrome/browser/devtools/BUILD.gn
+++ b/chrome/browser/devtools/BUILD.gn
@@ -4,13 +4,13 @@
 
 import("//extensions/buildflags/buildflags.gni")
 
-if (!is_android) {
+if (is_android) {
   import("//build/config/features.gni")
   import("//chrome/common/features.gni")
   import("//tools/grit/grit_rule.gni")
 }
 
-if (!is_android) {
+if (is_android) {
   _inspector_protocol = "//third_party/inspector_protocol"
   import("$_inspector_protocol/inspector_protocol.gni")
 
@@ -99,7 +99,7 @@ static_library("devtools") {
     "//ui/events:dom_keycode_converter",
   ]
 
-  if (!is_android) {
+  if (is_android) {
     deps += [
       "//chrome:extra_resources",
       "//chrome:resources",
@@ -180,19 +180,13 @@ static_library("devtools") {
       "url_constants.cc",
       "url_constants.h",
     ]
-    if (enable_service_discovery) {
-      sources += [
-        "device/cast_device_provider.cc",
-        "device/cast_device_provider.h",
-      ]
-    }
   }
   if (is_mac) {
     sources += [ "devtools_dock_tile_mac.mm" ]
   } else {
     sources += [ "devtools_dock_tile.cc" ]
   }
-  if (!is_android) {
+  if (is_android) {
     deps += [
       ":protocol_generated_sources",
       "//components/subresource_filter/content/browser:browser",
--- a/chrome/browser/ui/webui/discards/BUILD.gn
+++ b/chrome/browser/ui/webui/discards/BUILD.gn
@@ -4,7 +4,7 @@
 
 import("//mojo/public/tools/bindings/mojom.gni")
 
-if (is_win || is_mac || is_desktop_linux || is_chromeos) {
+if (is_win || is_mac || is_desktop_linux || is_chromeos || is_android) {
   mojom("mojo_bindings") {
     sources = [
       "discards.mojom",
--- a/chrome/common/extensions/api/api_sources.gni
+++ b/chrome/common/extensions/api/api_sources.gni
@@ -72,7 +72,7 @@ schema_sources_ = [
   "windows.json",
 ]
 
-if (!is_android) {
+if (is_android) {
   schema_sources_ += [ "processes.idl" ]
 }
 
--- a/ui/message_center/BUILD.gn
+++ b/ui/message_center/BUILD.gn
@@ -36,7 +36,7 @@ jumbo_component("message_center") {
 
   defines = [ "MESSAGE_CENTER_IMPLEMENTATION" ]
 
-  if (enable_message_center) {
+  if (true) {
     deps += [
       ":message_center_vector_icons",
       "//base:i18n",
@@ -88,7 +88,7 @@ jumbo_component("message_center") {
       ]
     }
 
-    if (toolkit_views) {
+    if (true) {
       sources += [
         "views/desktop_message_popup_collection.cc",
         "views/desktop_message_popup_collection.h",
--- a/components/bookmarks/browser/BUILD.gn
+++ b/components/bookmarks/browser/BUILD.gn
@@ -78,7 +78,7 @@ static_library("browser") {
     all_dependent_configs = [ "//ui/views:flags" ]
   }
 
-  if (toolkit_views && !is_mac) {
+  if (!is_mac) {
     sources += [ "bookmark_node_data_views.cc" ]
   }
 
--- a/ui/gfx/animation/BUILD.gn
+++ b/ui/gfx/animation/BUILD.gn
@@ -59,7 +59,7 @@ jumbo_component("animation") {
     ]
   }
 
-  if (!is_android) {
+  if (is_android) {
     sources += [
       "throb_animation.cc",
       "throb_animation.h",
--- a/chrome/chrome_paks.gni
+++ b/chrome/chrome_paks.gni
@@ -121,7 +121,7 @@ template("chrome_extra_paks") {
       sources += invoker.additional_paks
     }
 
-    if (!is_android) {
+    if (is_android) {
       # New paks should be added here by default.
       sources += [
         "$root_gen_dir/chrome/bookmarks_resources.pak",
--- a/content/browser/devtools/BUILD.gn
+++ b/content/browser/devtools/BUILD.gn
@@ -7,7 +7,7 @@ import("//third_party/protobuf/proto_lib
 import("//tools/grit/grit_rule.gni")
 
 group("resources") {
-  if (!is_android) {
+  if (is_android) {
     public_deps = [ ":devtools_resources" ]
   }
 }
--- a/build/config/locales.gni
+++ b/build/config/locales.gni
@@ -173,7 +173,7 @@ android_bundle_only_locales = [
 ]
 
 if (is_android) {
-  locales = all_chrome_locales
+  locales = all_chrome_locales - android_bundle_only_locales
 
   # Android doesn't ship all locales on KitKat in order to save space
   # (but webview does). http://crbug.com/369218
@@ -195,14 +195,12 @@ if (is_android) {
   android_bundle_locales_as_resources -= [
     "en-rUS",
     "es-r419",
-    "sr-rLatn",
     "fil",
     "he",
     "id",
   ]
   android_bundle_locales_as_resources += [
     "es-rUS",
-    "b+sr+Latn",
     "in",
     "iw",
     "tl",
--- a/chrome/android/BUILD.gn
+++ b/chrome/android/BUILD.gn
@@ -1493,7 +1493,6 @@ if (current_toolchain == default_toolcha
         }
       }
       if (!dfmify_dev_ui || !_is_bundle_module) {
-        additional_extra_paks += [ "$root_gen_dir/chrome/dev_ui_resources.pak" ]
         deps += [ "//chrome/browser/resources:dev_ui_paks" ]
       }
 
--- a/ui/gfx/BUILD.gn
+++ b/ui/gfx/BUILD.gn
@@ -403,8 +403,6 @@ jumbo_component("gfx") {
 
   if ((!use_aura && !toolkit_views) || is_ios) {
     sources -= [
-      "nine_image_painter.cc",
-      "nine_image_painter.h",
     ]
   }
 
--- a/components/performance_manager/BUILD.gn
+++ b/components/performance_manager/BUILD.gn
@@ -134,7 +134,7 @@ static_library("performance_manager") {
     "//url",
   ]
 
-  if (!is_android) {
+  if (is_android) {
     sources += [
       "persistence/site_data/exponential_moving_average.cc",
       "persistence/site_data/exponential_moving_average.h",
--- a/media/mojo/mojom/BUILD.gn
+++ b/media/mojo/mojom/BUILD.gn
@@ -50,7 +50,7 @@ mojom("mojom") {
 
   if (is_android) {
     sources += [ "android_overlay.mojom" ]
-  } else {
+
     sources += [ "speech_recognition_service.mojom" ]
   }
 
--- a/components/autofill/core/browser/BUILD.gn
+++ b/components/autofill/core/browser/BUILD.gn
@@ -383,7 +383,7 @@ jumbo_static_library("browser") {
     deps += [ "//third_party/blink/public/common" ]
   }
 
-  if (!is_android && !is_ios) {
+  if (is_android && !is_ios) {
     sources += [
       "payments/local_card_migration_manager.cc",
       "payments/local_card_migration_manager.h",
--- a/ui/webui/resources/BUILD.gn
+++ b/ui/webui/resources/BUILD.gn
@@ -10,7 +10,7 @@ group("closure_compile") {
     "js:closure_compile_modules",
   ]
 
-  if (!is_android) {
+  if (is_android) {
     deps += [
       "cr_components:closure_compile",
       "cr_elements:closure_compile",
@@ -25,7 +25,7 @@ group("modulize") {
     "js/cr/ui:modulize",
   ]
 
-  if (!is_android) {
+  if (is_android) {
     public_deps += [
       "cr_components:polymer3_elements",
       "cr_elements:polymer3_elements",
--- a/chrome/common/importer/BUILD.gn
+++ b/chrome/common/importer/BUILD.gn
@@ -25,8 +25,6 @@ source_set("importer") {
     "firefox_importer_utils_win.cc",
     "ie_importer_utils_win.cc",
     "ie_importer_utils_win.h",
-    "imported_bookmark_entry.cc",
-    "imported_bookmark_entry.h",
     "importer_autofill_form_data_entry.cc",
     "importer_autofill_form_data_entry.h",
     "importer_bridge.cc",
--- a/extensions/browser/api/system_cpu/BUILD.gn
+++ b/extensions/browser/api/system_cpu/BUILD.gn
@@ -7,13 +7,13 @@ import("//extensions/buildflags/buildfla
 assert(enable_extensions,
        "Cannot depend on extensions because enable_extensions=false.")
 
+set_sources_assignment_filter([])
+
 source_set("system_cpu") {
   sources = [
     "cpu_info_provider.cc",
     "cpu_info_provider.h",
     "cpu_info_provider_linux.cc",
-    "cpu_info_provider_mac.cc",
-    "cpu_info_provider_win.cc",
     "system_cpu_api.cc",
     "system_cpu_api.h",
   ]
--- a/chrome/browser/apps/platform_apps/api/music_manager_private/BUILD.gn
+++ b/chrome/browser/apps/platform_apps/api/music_manager_private/BUILD.gn
@@ -8,14 +8,13 @@ import("//rlz/buildflags/buildflags.gni"
 
 assert(enable_extensions)
 
+set_sources_assignment_filter([])
+
 source_set("music_manager_private") {
   sources = [
     "device_id.cc",
     "device_id.h",
-    "device_id_chromeos.cc",
     "device_id_linux.cc",
-    "device_id_mac.cc",
-    "device_id_win.cc",
     "music_manager_private_api.cc",
     "music_manager_private_api.h",
   ]
